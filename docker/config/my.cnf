# =============================================================================
# Configuration MariaDB 11.8 - Optimisée pour les Procédures Stockées
# =============================================================================
#
# Ce fichier contient les paramètres recommandés pour un environnement
# de développement/test axé sur les procédures stockées et la duplication.
#
# Auteur : Nicolas DEOUX (NDXDev@gmail.com)
# =============================================================================

[mysqld]
# -----------------------------------------------------------------------------
# Encodage et Collation
# -----------------------------------------------------------------------------
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init-connect = 'SET NAMES utf8mb4'

# -----------------------------------------------------------------------------
# Moteur de stockage par défaut
# -----------------------------------------------------------------------------
default-storage-engine = InnoDB

# -----------------------------------------------------------------------------
# Configuration InnoDB
# -----------------------------------------------------------------------------
# Taille du buffer pool (ajuster selon la RAM disponible)
innodb_buffer_pool_size = 256M

# Taille des fichiers de log (performance des transactions)
innodb_log_file_size = 64M

# Flush des logs à chaque commit (1 = sécurité maximale)
innodb_flush_log_at_trx_commit = 1

# Méthode de flush (O_DIRECT recommandé sous Linux)
innodb_flush_method = O_DIRECT

# Timeout pour les verrous (important pour les transactions longues)
innodb_lock_wait_timeout = 120

# -----------------------------------------------------------------------------
# Connexions
# -----------------------------------------------------------------------------
max_connections = 100
max_allowed_packet = 64M
wait_timeout = 600
interactive_timeout = 600

# -----------------------------------------------------------------------------
# Logs
# -----------------------------------------------------------------------------
# Log des erreurs
log_error = /var/lib/mysql/error.log

# Log des requêtes lentes (utile pour le débogage)
slow_query_log = 1
slow_query_log_file = /var/lib/mysql/slow.log
long_query_time = 2

# Log binaire (pour la réplication/récupération)
log_bin = mysql-bin
binlog_format = ROW
expire_logs_days = 7

# -----------------------------------------------------------------------------
# Procédures Stockées
# -----------------------------------------------------------------------------
# Permettre les routines non déterministes avec log binaire
log_bin_trust_function_creators = 1

# Taille maximale pour les résultats des procédures
max_sp_recursion_depth = 255

# Taille du buffer de tri (important pour les curseurs)
sort_buffer_size = 4M

# Buffer de lecture
read_buffer_size = 2M
read_rnd_buffer_size = 4M

# -----------------------------------------------------------------------------
# Tables temporaires
# -----------------------------------------------------------------------------
# Taille maximale des tables temporaires en mémoire
tmp_table_size = 64M
max_heap_table_size = 64M

# Répertoire des fichiers temporaires
tmpdir = /tmp

# -----------------------------------------------------------------------------
# Cache
# -----------------------------------------------------------------------------
# Cache des tables
table_open_cache = 400

# Cache des définitions de tables
table_definition_cache = 400

# -----------------------------------------------------------------------------
# Mode SQL
# -----------------------------------------------------------------------------
# Mode strict recommandé
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION

# -----------------------------------------------------------------------------
# Scheduler d'événements (pour les tâches planifiées)
# -----------------------------------------------------------------------------
event_scheduler = ON

# =============================================================================
# Configuration Client
# =============================================================================
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
